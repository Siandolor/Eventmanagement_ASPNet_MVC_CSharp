@model IEnumerable<Eventmanagement.Models.Events.EventBasics>

@{
    ViewData["Title"] = "Veranstaltungsübersicht";
    var organizer = ViewBag.Organizer as Eventmanagement.Models.Users.Organizer;
}

<h1>@ViewData["Title"] für "@organizer?.Organizer_CompanyName"</h1>

<p class="d-flex gap-3">
    <a asp-action="Create" asp-route-organizerId="@organizer?.Organizer_Id.ToString()" class="btn btn-outline-primary">Veranstaltung anlegen</a>
</p>

<table class="table">
    <thead>
        <tr>
            <th>
                <div class="justify-content-center align-content-center">
                    <h6 style="font-size: 16px;">Titel</h6>
                </div>
            </th>
            <th>
                <div class="justify-content-center align-content-center">
                    <h6 style="font-size: 16px;">Kategorie</h6>
                </div>
            </th>
            <th>
                <div class="justify-content-center align-content-center">
                    <h6 style="font-size: 16px;">Typ</h6>
                </div>
            </th>
            <th>
                <div class="justify-content-center align-content-center">
                    <h6 style="font-size: 16px;">Ort</h6>
                </div>
            </th>
            <th>
                <div class="justify-content-center align-content-center">
                    <h6 style="font-size: 16px;">Teilnehmerzahl</h6>
                </div>
            </th>
            <th>
                <div class="justify-content-center align-content-center">
                    <h6 style="font-size: 16px;">Start</h6>
                </div>
            </th>
            <th>
                <div class="justify-content-center align-content-center">
                    <h6 style="font-size: 16px;">Ende</h6>
                </div>
            </th>
            <th>
                <div class="justify-content-center align-content-center">
                    <h6 style="font-size: 16px;">Veröffentlicht</h6>
                </div>
            </th>
            <th>
                <div class="justify-content-center align-content-center">
                    <h6 style="font-size: 16px;">Ticketverkauf offen</h6>
                </div>
            </th>
            <th>
                <div class="justify-content-center align-content-center">
                    <h6 style="font-size: 16px;">Aktionen</h6>
                </div>
            </th>
            <th>
                <div class="justify-content-center align-content-center">
                    <h6 style="font-size: 16px;">Aktionen</h6>
                </div>
            </th>
            <th>
                <div class="justify-content-center align-content-center">
                    <h6 style="font-size: 16px;">Aktionen</h6>
                </div>
            </th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.OrderBy(e => e.StartDate).ThenBy(e => e.StartTime))
        {
            <tr>
                <td style="font-size: 12px;" class="align-content-center">
                    <div class="border border-info-subtle shadow-sm rounded-2 p-2">
                        <a asp-action="Details" asp-route-id="@item.Event_Id" class="text-decoration-none fw-bold">@item.Title</a>
                    </div>
                </td>
                <td style="font-size: 12px;" class="align-content-center">
                    @Html.DisplayFor(m => item.Category)
                </td>
                <td style="font-size: 12px;" class="align-content-center">
                    @Html.DisplayFor(m => item.Type)
                </td>
                <td style="font-size: 12px;" class="align-content-center">
                    @item.Location?.Location_CompanyName
                </td>
                <td style="font-size: 12px;" class="align-content-center">
                    @(item.MaxParticipants > 0 ? item.MaxParticipants.ToString() : "–")
                </td>
                <td style="font-size: 12px; width: 70px;" class="align-content-center">
                    @item.StartDate.ToShortDateString() <br /> @item.StartTime
                </td>
                <td style="font-size: 12px; width: 70px;" class="align-content-center">
                    @item.EndDate.ToShortDateString() <br /> @item.EndTime
                </td>
                <td style="font-size: 16px;" class="align-content-center">
                    <form asp-action="TogglePublish" asp-route-id="@item.Event_Id" method="post">
                        <button type="submit" class="btn btn-sm @(item.IsPublished ? "btn-success" : "btn-outline-secondary")" style="width: 105px; font-size: 12px;">
                            @(item.IsPublished ? "Veröffentlicht" : "Unveröffentlicht")
                        </button>
                    </form>
                </td>
                <td style="font-size: 16px;" class="align-content-center">
                    <form asp-action="ToggleTicketSale" asp-route-id="@item.Event_Id" method="post">
                        <button type="submit" class="btn btn-sm @(item.TicketSaleOpen ? "btn-success" : "btn-outline-secondary")" style="width: 160px; font-size: 12px;">
                            @(item.TicketSaleOpen ? "Ticketverkauf offen" : "Ticketverkauf geschlossen")
                        </button>
                    </form>
                </td>
                <td style="width: 200px;" class="align-top">
                    <div class="mb-2 d-grid gap-1">
                        <a style="font-size: 12px;" class="btn btn-sm btn-outline-secondary" asp-action="AddSession" asp-route-eventId="@item.Event_Id">Session hinzufügen</a>
                        <a style="font-size: 12px;" class="btn btn-sm btn-outline-secondary" asp-action="AddAttachment" asp-route-eventId="@item.Event_Id">Anhang hinzufügen</a>
                    </div>
                </td>
                <td style="width: 215px;" class="align-top">
                    <div class="mb-2 d-grid gap-1">
                        @{
                            var sessionMap = ViewBag.SessionMap as Dictionary<Guid, EventSession>;
                            var hasSession = ViewBag.HasSession as Dictionary<Guid, bool>;
                            var hasAttachment = ViewBag.HasAttachment as Dictionary<Guid, bool>;

                            var session = sessionMap?.GetValueOrDefault(item.Event_Id);
                            bool showSession = session != null;
                            bool showAttachment = hasAttachment?.GetValueOrDefault(item.Event_Id) == true;
                        }

                        @if (showSession)
                        {
                            <a class="btn btn-sm btn-outline-secondary" style="font-size: 12px;"
                               asp-action="EditSession"
                               asp-route-sessionId="@session.EventSession_Id">Session bearbeiten</a>
                        }
                        else
                        {
                            <button class="btn btn-sm btn-outline-secondary" style="font-size: 12px;" disabled>Sessions bearbeiten</button>
                        }

                        @if (showAttachment)
                        {
                            <a class="btn btn-sm btn-outline-secondary" style="font-size: 12px;"
                               asp-action="EditAttachment"
                               asp-route-eventId="@item.Event_Id">Anhänge bearbeiten</a>
                        }
                        else
                        {
                            <button class="btn btn-sm btn-outline-secondary" style="font-size: 12px;" disabled>Keine Anhänge</button>
                        }
                        <a style="font-size: 12px;" class="btn btn-sm btn-outline-secondary" asp-action="EditSeat" asp-route-eventId="@item.Event_Id"> Sitzplätze bearbeiten</a>
                    </div>
                </td>
                <td style="width: 100px;" class="align-top">
                    <div class="d-grid gap-1">
                        <a style="font-size: 12px;" class="btn btn-sm btn-warning text-dark border-dark"
                           asp-action="Edit"
                           asp-route-id="@item.Event_Id">
                            Edit
                        </a>
                        <form asp-action="Delete" asp-route-id="@item.Event_Id" method="post" class="d-grid">
                            <button style="font-size: 12px;" type="submit" class="btn btn-sm btn-danger text-light border-dark">
                                Löschen
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
        }
    </tbody>
</table>
